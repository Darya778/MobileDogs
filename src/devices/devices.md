## Функции для работы с ошейниками

**1. `create_dog_collar(collar: DogCollarCreate, db: Session = Depends(get_db))`**

Описание: Эта функция отвечает за создание новых ошейников.

Параметры:

* `collar: DogCollarCreate`: Данные нового ошейника, которые передаются в виде объекта `DogCollarCreate`.
* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.add_dog_collar` для добавления нового ошейника в базу данных.
2. Если функция `db_manager.add_dog_collar` успешно добавляет ошейник, функция записывает информацию об успешном добавлении в лог и возвращает ID ошейника и сообщение об успешном добавлении.
3. Обрабатывает любые исключения, возникшие в процессе добавления, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.


**2. `update_dog_collar(collar_id: int, collar_update: DogCollarUpdate, db: Session = Depends(get_db))`**

Описание: Эта функция отвечает за обновление данных существующего ошейника.

Параметры:

* `collar_id: int`: ID ошейника, который нужно обновить.
* `collar_update: DogCollarUpdate`: Данные для обновления, которые передаются в виде объекта `DogCollarUpdate`.
* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.update_dog_collar` для обновления данных ошейника в базе данных.
2. Если функция `db_manager.update_dog_collar` успешно обновляет данные, функция записывает информацию об успешном обновлении в лог и возвращает сообщение об успешном обновлении.
3. Обрабатывает любые исключения, возникшие в процессе обновления, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.


**3. `delete_dog_collar(collar_id: int, db: Session = Depends(get_db))`**

Описание: Эта функция отвечает за удаление (архивацию) ошейника.

Параметры:

* `collar_id: int`: ID ошейника, который нужно удалить.
* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.archive_dog_collar` для архивирования ошейника в базе данных.
2. Если функция `db_manager.archive_dog_collar` успешно архивирует ошейник, функция записывает информацию об успешном удалении в лог и возвращает сообщение об успешном удалении.
3. Обрабатывает любые исключения, возникшие в процессе удаления, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.

**4. `get_all_dog_collars(db: Session = Depends(get_db))`**

Описание: Эта функция возвращает список всех ошейников.

Параметры:

* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.query_all_dog_collars` для получения всех ошейников из базы данных.
2. Если функция `db_manager.query_all_dog_collars` успешно возвращает список ошейников, функция записывает информацию об успешном получении в лог и возвращает список ошейников.
3. Обрабатывает любые исключения, возникшие в процессе получения, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.

**5. `create_coordinate(coordinate: CoordinateCreate, db: Session = Depends(get_db))`**

Описание: Эта функция отвечает за создание новых координат.

Параметры:

* `coordinate: CoordinateCreate`: Данные новых координат, которые передаются в виде объекта `CoordinateCreate`.
* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.add_coordinate` для добавления новых координат в базу данных.
2. Если функция `db_manager.add_coordinate` успешно добавляет координаты, функция записывает информацию об успешном добавлении в лог и возвращает ID координат и сообщение об успешном добавлении.
3. Обрабатывает любые исключения, возникшие в процессе добавления, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.


**6. `update_coordinate(coordinate_id: int, coordinate_update: CoordinateUpdate, db: Session = Depends(get_db))`**

Описание: Эта функция отвечает за обновление данных существующих координат.

Параметры:

* `coordinate_id: int`: ID координат, которые нужно обновить.
* `coordinate_update: CoordinateUpdate`: Данные для обновления, которые передаются в виде объекта `CoordinateUpdate`.
* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.update_coordinate` для обновления данных координат в базе данных.
2. Если функция `db_manager.update_coordinate` успешно обновляет данные, функция записывает информацию об успешном обновлении в лог и возвращает сообщение об успешном обновлении.
3. Обрабатывает любые исключения, возникшие в процессе обновления, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.

**7. `delete_coordinate(coordinate_id: int, db: Session = Depends(get_db))`**

Описание: Эта функция отвечает за удаление координат.

Параметры:

* `coordinate_id: int`: ID координат, которые нужно удалить.
* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.delete_coordinate` для удаления координат из базы данных.
2. Если функция `db_manager.delete_coordinate` успешно удаляет координаты, функция записывает информацию об успешном удалении в лог и возвращает сообщение об успешном удалении.
3. Обрабатывает любые исключения, возникшие в процессе удаления, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.

**8. `get_track(collar_id: int, start_time: str, end_time: str, db: Session = Depends(get_db))`**

Описание: Эта функция возвращает список координат для заданного ошейника за определенный период времени.

Параметры:

* `collar_id: int`: ID ошейника.
* `start_time: str`: Начальное время периода.
* `end_time: str`: Конечное время периода.
* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.get_track` для получения списка координат из базы данных.
2. Если функция `db_manager.get_track` успешно возвращает список координат, функция записывает информацию об успешном получении в лог и возвращает список координат.
3. Обрабатывает любые исключения, возникшие в процессе получения, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.


**9. `create_user_dog_collar(binding: UserDogCollarCreate, db: Session = Depends(get_db))`**

Описание: Эта функция отвечает за создание новой связи между пользователем и ошейником.

Параметры:

* `binding: UserDogCollarCreate`: Данные новой связи, которые передаются в виде объекта `UserDogCollarCreate`.
* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.add_user_dog_collar` для добавления новой связи в базу данных.
2. Если функция `db_manager.add_user_dog_collar` успешно добавляет связь, функция записывает информацию об успешном добавлении в лог и возвращает ID пользователя, ID ошейника и сообщение об успешном добавлении.
3. Обрабатывает любые исключения, возникшие в процессе добавления, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.


**10. `update_user_dog_collar(binding_id: int, binding_update: UserDogCollarUpdate, db: Session = Depends(get_db))`**

Описание: Эта функция отвечает за обновление данных существующей связи между пользователем и ошейником.

Параметры:

* `binding_id: int`: ID связи, которую нужно обновить.
* `binding_update: UserDogCollarUpdate`: Данные для обновления, которые передаются в виде объекта `UserDogCollarUpdate`.
* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.update_user_dog_collar` для обновления данных связи в базе данных.
2. Если функция `db_manager.update_user_dog_collar` успешно обновляет данные, функция записывает информацию об успешном обновлении в лог и возвращает сообщение об успешном обновлении.
3. Обрабатывает любые исключения, возникшие в процессе обновления, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.

**11. `delete_user_dog_collar(binding_id: int, db: Session = Depends(get_db))`**

Описание: Эта функция отвечает за удаление связи между пользователем и ошейником.

Параметры:

* `binding_id: int`: ID связи, которую нужно удалить.
* `db: Session`: Сессия базы данных, полученная из контекста зависимости `get_db`.

Действия:

1. Вызывает функцию `db_manager.archive_user_dog_collar` для удаления связи из базы данных.
2. Если функция `db_manager.archive_user_dog_collar` успешно удаляет связь, функция записывает информацию об успешном удалении в лог и возвращает сообщение об успешном удалении.
3. Обрабатывает любые исключения, возникшие в процессе удаления, записывает их в лог и генерирует исключение `HTTPException` с кодом 500 и описанием ошибки.

### Дополнительные замечания:

* `db_manager`: Класс, который предоставляет функции для взаимодействия с базой данных.
* `log_message`:  Функция для записи сообщений в лог-файл.
* `HTTPException`:  Это исключение используется для генерации ответа HTTP с кодом ошибки.

### Пример использования:

```python
# Создание нового ошейника
collar_data = DogCollarCreate(uni_num_dog="1234567890", name_dog="Rex", ...)
collar_id, message = create_dog_collar(collar_data, db)

# Обновление данных ошейника
collar_update_data = DogCollarUpdate(name_dog="Rexy", ...)
update_dog_collar(collar_id, collar_update_data, db)

# Удаление (архивирование) ошейника
delete_dog_collar(collar_id, db)

# Получение списка всех ошейников
all_collars = get_all_dog_collars(db)

# Создание новых координат
coordinate_data = CoordinateCreate(collar_id=collar_id, latitude=55.7558, longitude=37.6173)
coordinate_id, message = create_coordinate(coordinate_data, db)

# Обновление данных координат
coordinate_update_data = CoordinateUpdate(latitude=55.7560, longitude=37.6175)
update_coordinate(coordinate_id, coordinate_update_data, db)

# Удаление координат
delete_coordinate(coordinate_id, db)

# Получение списка координат для ошейника за определенный период
track = get_track(collar_id, "2023-10-27T10:00:00Z", "2023-10-27T12:00:00Z", db)

# Создание связи между пользователем и ошейником
binding_data = UserDogCollarCreate(id_user=123, id_collar=collar_id)
userid,dogid,message = create_user_dog_collar(binding_data, db)

# Обновление данных связи
binding_update_data = UserDogCollarUpdate(id_user=123, id_collar=901)
update_user_dog_collar(binding_id, binding_update_data, db)

# Удаление связи
delete_user_dog_collar(binding_id, db)
```
